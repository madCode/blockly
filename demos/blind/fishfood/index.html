<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blind Blockly Sandbox</title>
  <script src="../../../blockly_compressed.js"></script>
  <script src="../../../blocks_compressed.js"></script>
  <script src="../../../javascript_compressed.js"></script>
  <script src="../../../msg/js/en.js"></script>

  <script src="music_player.js"></script>

  <!-- Libraries for MIDI playback. -->
  <script src="../../../MIDI.js/build/MIDI.js"></script>
  <script src="../../../MIDI.js/inc/shim/Base64binary.js"></script>

  <!-- 1. Load libraries -->
    <!-- IE required polyfill -->
    <script src="../libs/es6-shim.min.js"></script>
    <script src="../libs/angular2-polyfills.min.js"></script>
    <script src="../libs/Rx.umd.min.js"></script>
    <script src="../libs/angular2-all.umd.min.js"></script>
    <!--<script src="node_modules/systemjs/dist/system.js"></script>-->


  <style>
    body {
      background-color: #e5ffff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    td {
      vertical-align: top;
    }
    textarea {
      width: 100%;
      height: 20em;
    }
    .tree .activedescendant > label, .activedescendant > button, .activedescendant > input {outline: 2px dotted #00f;}
    /*.tree .activedescendant {outline: 2px dotted #00f;}*/
  </style>
</head>
<body>

  <levelview></levelview>

  <!-- 2. Load our app -->
  <script src='app/clipboard.service.js'></script>
  <script src='app/tree.service.js'></script>
  <script src='app/workspace/fieldview.component.js'></script>
  <script src='app/workspace/treeview.component.js'></script>
  <script src='app/toolbox/toolbox_treeview.component.js'></script>
  <script src='app/toolbox/toolboxview.component.js'></script>
  <script src='app/workspace/workspaceview.component.js'></script>
  <script src='app/appview.component.js'></script>
  <script src='app/levelmanager.component.js'></script>
  <script src='app/boot.js'></script>

<script>
  // Depending on the URL argument, render as LTR or RTL.
  var musicPlayer = new MusicPlayer();
  var activeTimeouts = [];


  // The code generated by the blocks calls this function.
  function addBassChord(pitches, durationInBeats) {
    musicPlayer.addBassChord(pitches, durationInBeats);
  }
  function playAndGrade() {
    musicPlayer.reset();
    runCodeToPopulateBassLine();
    musicPlayer.playBassLine(app.gameManager.validateLevel);
  }
  function runCodeToPopulateBassLine() {
    // Generate JavaScript code and run it.
    window.LoopTrap = 1000;
    Blockly.JavaScript.INFINITE_LOOP_TRAP =
        'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
    var code = Blockly.JavaScript.workspaceToCode(app.workspace);
    Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    try {
      eval(code);
    } catch (e) {
      alert(e);
    }
  }
</script>
</body>
</html>
